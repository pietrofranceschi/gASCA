<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASCA Decomposition of Synthetic Count Data • ASCA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ASCA Decomposition of Synthetic Count Data">
<meta property="og:description" content="ASCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ASCA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Asca_dec_count_data.html">ASCA Decomposition of Synthetic Count Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Asca_dec_count_data_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ASCA Decomposition of Synthetic Count Data</h1>
                        <h4 class="author">Pietro Franceschi</h4>
            
            <h4 class="date">2021-08-05</h4>
      
      
      <div class="hidden name"><code>Asca_dec_count_data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<ul>
<li>Visualize the characteristics of multifactorial designs in multivariate context.</li>
<li>With standard PCA one focuses on the effect responsible of the larger variance. This does not allow neither to disentangle the contribution of the different design factors nor to pinpoint the variables which are most influential for each factor</li>
<li>The idea of ASCA is to couple ANOVA decomposition with PCA. ANOVA is used to model each variable as a function of the different elements of the design, PCA is then applied drive a multivariate interpretation of the matrices holding the univariate expected values for each design factor.</li>
<li>In matrix representation the ASCA decomposition is Y = A + B + C + … + Err where each matrix holds the expected values</li>
<li>The expected values can be estimated in different way, but using glm to do that has two advantages: the approach can be applied the method to unbalanced designs, one can extend the idea to response variables with non gaussian distribution like the one which are encountered in ecology or metagenomics.</li>
<li>This second perspective is extremely interesting due to the growing availability of complex ecological and biological datasets</li>
</ul>
</div>
<div id="the-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#the-dataset" class="anchor"></a>The dataset</h2>
<p>To illustrate the usefulness of ASCA in the analysis of count data we will considered a synthetic dataset which is available as a part of the package installation.</p>
<div id="experimental-design" class="section level3">
<h3 class="hasAnchor">
<a href="#experimental-design" class="anchor"></a>Experimental design</h3>
<ul>
<li>10 count variables (identified as <code>s1 .. s10</code>)</li>
<li>2 factor design (5 time points, 3 treatments)</li>
<li>45 samples</li>
</ul>
<p>The example dataset was designed to have two latent variables for the time factor and one for the treatment.</p>
<p>The dataset is included in the package as a two element list containing the count matrix <code>synth_count_data$counts</code> and a data frame holding the association between the 45 samples and the design factors (<code>synth_count_data$design</code>)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load the libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ASCA</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: parallel</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.5     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.3     ✓ dplyr   1.0.7</span>
<span class="co">#&gt; ✓ tidyr   1.1.3     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   2.0.0     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x tidyr::expand() masks Matrix::expand()</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="co">#&gt; x tidyr::pack()   masks Matrix::pack()</span>
<span class="co">#&gt; x tidyr::unpack() masks Matrix::unpack()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>

<span class="co">## load the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"synth_count_data"</span><span class="op">)</span>

<span class="co">## show a compact representation of the structure of the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">)</span>
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ counts: int [1:45, 1:10] 0 2 1 0 0 1 0 0 1 2 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ design:'data.frame':  45 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ time     : chr [1:45] "t1" "t1" "t1" "t1" ...</span>
<span class="co">#&gt;   ..$ treatment: chr [1:45] "A" "A" "A" "B" ...</span></code></pre></div>
<p>Here we are dealing with a design with 5 time points and three treatments</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## time</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
<span class="co">#&gt; [1] "t1" "t2" "t3" "t4" "t5"</span>

<span class="co">## treatment</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>
<span class="co">#&gt; [1] "A" "B" "C"</span></code></pre></div>
<p>The following plot shows the distribution of the counts for the first specie as a function of the design factors</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Palette for time factor</span>
<span class="va">timepal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#e41a1c"</span>,<span class="st">"#377eb8"</span>,<span class="st">"#4daf4a"</span>,<span class="st">"#984ea3"</span>,<span class="st">"#ff7f00"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">timepal</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>

<span class="co">## point shapes for treatments</span>
<span class="va">treatpch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">13</span>,<span class="fl">17</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">treatpch</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>


<span class="co">## plot the trend of the first specie</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, 
     col <span class="op">=</span> <span class="va">timepal</span><span class="op">[</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">]</span>, 
     pch <span class="op">=</span> <span class="va">treatpch</span><span class="op">[</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">]</span>, 
     ylab <span class="op">=</span> <span class="st">"Counts"</span>, xlab <span class="op">=</span> <span class="st">"Sample id"</span>, main <span class="op">=</span> <span class="st">"Specie 1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">timepal</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">timepal</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, pch <span class="op">=</span> <span class="va">treatpch</span>, col <span class="op">=</span> <span class="st">"gray70"</span>, 
       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">treatpch</span><span class="op">)</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-3-1.png" alt="Illustration of the effects of the experimental design on the counts of Specie #1" width="700"><p class="caption">
Illustration of the effects of the experimental design on the counts of Specie #1
</p>
</div>
<p>The plot clearly shows the non normal distribution of the count data and dependence of the response variable on the design factors.</p>
</div>
</div>
<div id="performing-the-decomposition" class="section level2">
<h2 class="hasAnchor">
<a href="#performing-the-decomposition" class="anchor"></a>Performing the decomposition</h2>
<p>The function which performs the decomposition is <code>ASCA_decompose</code> and the results are organized in a list. To run the function it is necessary to provide:</p>
<ul>
<li>a <code>matrix</code> or a <code>data.frame</code> with the counts</li>
<li>a <code>data.frame</code> with the association between the samples and the design. Beware that numeric columns will results in a decomposition error!</li>
<li>a formula (actually a character vector) which specify the form of the decomposition</li>
<li>a <code>list</code> with the parameters which will be passed to the <code>glm</code> call</li>
<li>a character vector which specifies the type of errors which will be returned by <code>glm</code>
</li>
</ul>
<p>For a detailed discussion of the properties of the different GLM error please refer to the documentation of <code>residuals.glm</code>. By default <code>ASCA_decompose</code> return <em>Pearson</em> residuals which are defined as</p>
<p><span class="math display">\[
r_{p} = \frac{y - \hat{\mu}}{\sqrt{V(\hat{\mu)}}}
\]</span></p>
<p>Where <span class="math inline">\(V(\hat{\mu})\)</span> is the standard error of the estimated expected value.</p>
<p>In the case of our count data, the glm should be performed by specifying a Poisson family</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## perform the decomposition</span>
<span class="va">asca0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_decompose.html">ASCA_decompose</a></span><span class="op">(</span>
  d <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>,
  x <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span>, 
  f <span class="op">=</span> <span class="st">"time + treatment + time:treatment"</span>,
  glm_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s give a look to the structure of the asca0 object</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ decomposition: num [1:45, 1:5, 1:10] 1.92 1.92 1.92 1.92 1.92 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 3</span>
<span class="co">#&gt;   .. ..$ : chr [1:45] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:5] "mu" "time" "treatment" "time:treatment" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ deviance     : num [1:10] 39.6 40.8 50.8 30.8 26.5 ...</span>
<span class="co">#&gt;  $ glm_par      :List of 1</span>
<span class="co">#&gt;   ..$ family:List of 12</span>
<span class="co">#&gt;   .. ..$ family    : chr "poisson"</span>
<span class="co">#&gt;   .. ..$ link      : chr "log"</span>
<span class="co">#&gt;   .. ..$ linkfun   :function (mu)  </span>
<span class="co">#&gt;   .. ..$ linkinv   :function (eta)  </span>
<span class="co">#&gt;   .. ..$ variance  :function (mu)  </span>
<span class="co">#&gt;   .. ..$ dev.resids:function (y, mu, wt)  </span>
<span class="co">#&gt;   .. ..$ aic       :function (y, n, mu, wt, dev)  </span>
<span class="co">#&gt;   .. ..$ mu.eta    :function (eta)  </span>
<span class="co">#&gt;   .. ..$ initialize:  expression({  if (any(y &lt; 0))  stop("negative values not allowed for the 'Poisson' family")  n &lt;- rep.int(1, nobs| __truncated__</span>
<span class="co">#&gt;   .. ..$ validmu   :function (mu)  </span>
<span class="co">#&gt;   .. ..$ valideta  :function (eta)  </span>
<span class="co">#&gt;   .. ..$ simulate  :function (object, nsim)  </span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "family"</span>
<span class="co">#&gt;  $ res_type     : chr "pearson"</span></code></pre></div>
<p>The main output of the function is a 3D matrix which holds the result of the decomposition. Printing the names allow to understand the structure of the output</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13" "14" "15"</span>
<span class="co">#&gt; [16] "16" "17" "18" "19" "20" "21" "22" "23" "24" "25" "26" "27" "28" "29" "30"</span>
<span class="co">#&gt; [31] "31" "32" "33" "34" "35" "36" "37" "38" "39" "40" "41" "42" "43" "44" "45"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "mu"             "time"           "treatment"      "time:treatment"</span>
<span class="co">#&gt; [5] "error"         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;  [1] "s1"  "s2"  "s3"  "s4"  "s5"  "s6"  "s7"  "s8"  "s9"  "s10"</span></code></pre></div>
<p>The 45 samples are organized in the first dimension. The terms of the decomposition are organized in the second dimension. the last dimension holds the variable names (here the species).</p>
<p>The <code>deviance</code> element of the list contains the deviance of the univariate models which are used to calculate the expected values which are used to construct the decomposition. It could be used to spot the presence of variables which were badly modeled by the proposed formula or to select the best parameters to be used in the glm call</p>
<p>In the specific case</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">deviance</span>, type <span class="op">=</span> <span class="st">"b"</span>,
     main <span class="op">=</span> <span class="st">"Deviance"</span>,
     ylab <span class="op">=</span> <span class="st">"Deviance"</span>,
     xlab <span class="op">=</span> <span class="st">"Var id"</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The remaining two elements of the list contains the parameters which were used in the glm call and the type of residuals</p>
</div>
<div id="performing-the-svd-of-the-decomposition" class="section level2">
<h2 class="hasAnchor">
<a href="#performing-the-svd-of-the-decomposition" class="anchor"></a>Performing the SVD of the decomposition</h2>
<p>The SVD of the results of the decomposition is performed by the <code>ASCA_svd</code> function, which takes as input a 3D decomposition array. Rank 1 terms will be dropped from the output.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_svd.html">ASCA_svd</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span><span class="op">)</span></code></pre></div>
<p>As discussed in the manual the output of the SVD is a list of lists holding infos on the scores, the loadings, the variable importance and the amount ov variance explained by each eigenvector.</p>
<ul>
<li>The <strong>loadings</strong> measure the weights of each one of the initial variables (here the species) on each one of the component resulting from the decomposition of each term.</li>
<li>The <strong>variable importance</strong> accounts for the overall importance of each variable on each term and it is calculated by weighting the loadings for each component by the size of each singular value.</li>
<li>The <strong>scores</strong> represent the “coordinates” of the samples on the subspace defined by the components of each term. As is typically done for glms, the scores can be represented either in the “link” or in the “response” space. The “link” space is the one of the linear predictor - i.e. after the application of the link function -, while the “response” space is the one were the actual matrix was living. In terms of interpretation, it is often preferred to go back to the “response” space, where it is easier to relate the expected values with the actual measured quantities. The decomposition of a matrix of counts (family Poisson, link log), for example, will result in positive matrices only in the response space. Unfortunately, there is also a price to pay with this choice: the terms of the decomposition are indeed not anymore adding up to the original matrix.</li>
</ul>
<p>Let’s consider, for example, the <em>time</em> factor.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span><span class="op">$</span><span class="va">variances</span><span class="op">$</span><span class="va">time</span>
<span class="co">#&gt; [1] 357.1261041 122.3018931   0.5806419   0.1887684</span></code></pre></div>
<p>The svd of this factor results im four eigenvectors (which is n - 1 the levels of the time factor). The first two are accounting for the large majority of the term specific variance. So it is worth looking to them in the “loadings” plot.</p>
<p>In absolute terms, the contribution of each term to the overall variance can be assessed by summing over the eigenvectors of each term:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">asca0_svd</span><span class="op">$</span><span class="va">variances</span>, <span class="va">sum</span><span class="op">)</span>
<span class="co">#&gt;             mu           time      treatment time:treatment          error </span>
<span class="co">#&gt;         0.0000       480.1974       101.4129        31.5180       440.0000</span></code></pre></div>
<ul>
<li>
<code>mu</code> is by contruction a matrix of rank 1, so its contribution to the overall variance is zero.</li>
<li>The factor <code>time</code> accounts for the larger part of the variability.</li>
<li>The interpretation of the <code>error</code> term is not straightforward. With glms, indeed, the size of this term depends on the type of residual which was considered.</li>
</ul>
<p>The error does not tell so much, since it depends on the way we calculated the residuals.</p>
<p>Let’s plot the important of each initial specie (variable) to the time factor</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">asca0_svd</span><span class="op">$</span><span class="va">varimp</span><span class="op">$</span><span class="va">time</span>, main <span class="op">=</span> <span class="st">"Variable Importance - time"</span>, 
        ylab <span class="op">=</span> <span class="st">"variable importance"</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>So species s1,s2 and to a lower extent s3 and s4 are the oe more affected by the time factor. To check that we rely on <code>ggplot</code> and <code>tidyverse</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>, <span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">3</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-12-1.png" width="864"></p>
<p>The plot perfectly confirms the results of the analysis, the signal of species 1,2,3,4 is indeed the one more affected by the time factor.</p>
<p>The eigen decomposition of the time matrix also allow to identify four latent “trends” (the first two being the stronger). The ASCA results can be used to identify these trends and also spot which one of the species are mostly contributing to each one of them. Let’s start plotting the “eigen trends”, in order to do that we plot the scores of each component against the values of the initial factor. Here there is an important point to discuss. In the glm based ASCA, the decomposition and the SVD are performed on the scale of the linear predictor, so the expected values are also living in that space. They cannot be directly interpreted unless we project them in the “response” space</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svd_response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_svd_response.html">ASCA_svd_response</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span>, 
                                     <span class="va">asca0</span><span class="op">$</span><span class="va">glm_par</span><span class="op">$</span><span class="va">family</span><span class="op">$</span><span class="va">linkinv</span><span class="op">)</span></code></pre></div>
<p>Another time we rely on tidyverse and ggplot</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span>,<span class="va">svd_response</span><span class="op">$</span><span class="va">scores</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>, <span class="va">eig1</span>, <span class="va">eig2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"eig"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The two time trends are clearly visible. Remember that here we are plotting the model expected values, so there are six observations (replicates) for level.</p>
<p>What are the species, mostly contributing to these two trends?To get that let’s consider the loadings.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">time</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">species</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">species</span>,<span class="va">eig1</span>,<span class="va">eig2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"eig"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The previous plot indicate that s1 and s2 mainly contribute to the first eigentrend. Since the loading is positive they are expected to get higher counts where the trend is positive, so for t4 and t5. S3 and s4 are the highest contributor to the second eigentrend, and should have larger values for times t2,t3,t4</p>
<p>Let’s give a look to the treatment term</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span>,<span class="va">svd_response</span><span class="op">$</span><span class="va">scores</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">treatment</span>, <span class="va">eig1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"eig"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">treatment</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">species</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">species</span>,<span class="va">eig1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"eig"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>So species s5 and s6 are higher showing the eigen-treatment pattern shown in the previous figure</p>
</div>
<div id="combining-terms" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-terms" class="anchor"></a>Combining terms</h2>
<p>To facilitate the interpretation of the ASCA decomposition, in particular when time trends are present, it can be useful to combine some of the terms before svd. In the case we are considering here, for example, to clearly highlight the effect of treatment over time, it is useful to combine the <code>treatment</code> and <code>time:treatment</code>. After this combination, the svd will indeed highlight the species/variables which are strongly associated to the treatment with the ones with are primarily depending on time.</p>
<p>To combine two terms of the decomposition we rely on the <code>ASCA_combine_terms</code> function, which basically directly sum up them</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">combined_decomposition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_combine_terms.html">ASCA_combine_terms</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span>, comb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"treatment"</span>,<span class="st">"time:treatment"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The difference in the decomposition matrix are clearly visible in the dimnames</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">combined_decomposition</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;  [1] "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12" "13" "14" "15"</span>
<span class="co">#&gt; [16] "16" "17" "18" "19" "20" "21" "22" "23" "24" "25" "26" "27" "28" "29" "30"</span>
<span class="co">#&gt; [31] "31" "32" "33" "34" "35" "36" "37" "38" "39" "40" "41" "42" "43" "44" "45"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "mu"                       "time"                    </span>
<span class="co">#&gt; [3] "error"                    "treatment+time:treatment"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;  [1] "s1"  "s2"  "s3"  "s4"  "s5"  "s6"  "s7"  "s8"  "s9"  "s10"</span></code></pre></div>
<p>The svd now turns out to be</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svd_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_svd.html">ASCA_svd</a></span><span class="op">(</span><span class="va">combined_decomposition</span><span class="op">)</span></code></pre></div>
<p>the variable importance of the combined terms</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">svd_combined</span><span class="op">$</span><span class="va">varimp</span><span class="op">$</span><span class="va">`treatment+time:treatment`</span>,
        main <span class="op">=</span> <span class="st">"Variable Importance - treatment+time:treatment "</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>So the species which are mostly associated to the treatment and to its interaction with time are s1,s2.s5,s6, and this is in keeping with the plot of the individual abundances shown before</p>
<p>In term of number of components, the variance profile of the combined terms suggest that the two eigenvector model accounts for a large part of the variance.</p>
<p>How the score plot looks like?</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>, 
                 <span class="va">svd_combined</span><span class="op">$</span><span class="va">scores</span><span class="op">$</span><span class="va">`treatment+time:treatment`</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">eig1</span>, y <span class="op">=</span> <span class="va">eig2</span>, col <span class="op">=</span> <span class="va">time</span>, pch <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>,  
             position <span class="op">=</span> <span class="fu">position_jitter</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"YlOrRd"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Here a small amount of jitter was added in the x and y direction to show the individual samples.</p>
<p>The previous scoreplot shows that along <code>eig1</code> the samples are separated according to the treatment, while <code>eig2</code> captures the different time dependence.</p>
<p>In terms of loadings plot</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svd_combined</span><span class="op">$</span><span class="va">loadings</span><span class="op">$</span><span class="va">`treatment+time:treatment`</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"specie"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xend <span class="op">=</span> <span class="va">eig1</span>, yend <span class="op">=</span> <span class="va">eig2</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">0</span> , y <span class="op">=</span> <span class="fl">0</span>,
               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.3</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">eig1</span>, y <span class="op">=</span> <span class="va">eig2</span>, label <span class="op">=</span> <span class="va">specie</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>The previous plots are highlighting several interesting points</p>
<ul>
<li>s5 and s6 are sensitive to the treatment effect and are higher for treatment B</li>
<li>s1 and s2 are sensitive to the interaction between treatment and time (so their time trend is different for the different treatments)</li>
<li>s1 and s2 are higher for treatment <code>C</code> and time point <code>t4</code>
</li>
</ul>
<p>All these observations are in keeping with the specie trends</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Pietro Franceschi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
