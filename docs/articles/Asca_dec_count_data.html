<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASCA Decomposition of Synthetic Count Data • gASCA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ASCA Decomposition of Synthetic Count Data">
<meta property="og:description" content="gASCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gASCA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Asca_dec_count_data.html">ASCA Decomposition of Synthetic Count Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Asca_dec_count_data_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ASCA Decomposition of Synthetic Count Data</h1>
                        <h4 class="author">Pietro Franceschi</h4>
            
      
      
      <div class="hidden name"><code>Asca_dec_count_data.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>To illustrate the use of ASCA in the analysis of count data we will considered a synthetic dataset which is available as a part of the package installation. This vignette will be also used to show how to use gg-style plotting to visualize the results of the ASCA analysis</p>
</div>
<div id="the-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#the-dataset" class="anchor"></a>The dataset</h2>
<p>The synthetic data were ***</p>
<div id="experimental-design" class="section level3">
<h3 class="hasAnchor">
<a href="#experimental-design" class="anchor"></a>Experimental design</h3>
<ul>
<li>10 count variables (identified as <code>s1 .. s10</code>)</li>
<li>2 factor design (5 time points, 3 treatments)</li>
<li>10 replicates</li>
</ul>
<p>The example dataset was designed to have two latent variables for the time factor and one for the treatment.</p>
<p>Considering the 10 variables:</p>
<ul>
<li>the first four are responsive to the time factor. <code>s1</code> and <code>s2</code> mirrors LV1, <code>s3</code> and <code>s4</code> are linked to LV2.</li>
<li>
<code>s5</code> and <code>s6</code> are affected by the treatment factor.</li>
<li>
<code>s1</code> and <code>s2</code> are also sensitive to the interaction. In other words, for them the effect of treatment depends on time.</li>
<li>The remaining variables contain only noise.</li>
</ul>
<p>The dataset is included in the package as a two element list containing the count matrix <code>synth_count_data$counts</code> and a data frame holding the association between the 150 samples and the design factors (<code>synth_count_data$design</code>)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load the libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gASCA</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: parallel</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: replacing previous import 'lifecycle::last_warnings' by</span>
<span class="co">#&gt; 'rlang::last_warnings' when loading 'pillar'</span>
<span class="co">#&gt; Warning: replacing previous import 'lifecycle::last_warnings' by</span>
<span class="co">#&gt; 'rlang::last_warnings' when loading 'tibble'</span>
<span class="co">#&gt; Warning: replacing previous import 'lifecycle::last_warnings' by</span>
<span class="co">#&gt; 'rlang::last_warnings' when loading 'hms'</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.5     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.4     ✓ dplyr   1.0.7</span>
<span class="co">#&gt; ✓ tidyr   1.1.3     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   2.0.1     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x tidyr::expand() masks Matrix::expand()</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="co">#&gt; x tidyr::pack()   masks Matrix::pack()</span>
<span class="co">#&gt; x tidyr::unpack() masks Matrix::unpack()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>

<span class="co">## load the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"synth_count_data"</span><span class="op">)</span>

<span class="co">## show a compact representation of the structure of the dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">)</span>
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ counts: int [1:150, 1:10] 0 0 0 1 0 2 1 1 1 0 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ design:'data.frame':  150 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ time     : chr [1:150] "t1" "t1" "t1" "t1" ...</span>
<span class="co">#&gt;   ..$ treatment: chr [1:150] "A" "A" "A" "A" ...</span></code></pre></div>
<p>In this synthetic dataset we are dealing with a design with 5 time points and three treatments</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## time</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
<span class="co">#&gt; [1] "t1" "t2" "t3" "t4" "t5"</span>

<span class="co">## treatment</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span>
<span class="co">#&gt; [1] "A" "B" "C"</span></code></pre></div>
<p>The following plot shows the distribution of the counts for variable <code>s1</code> as a function of the design factors</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">s1</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,
             position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Variable S1"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span>, 
        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-3-1.png" alt="Illustration of the effects of the experimental design on the counts of Species #1" width="700"><p class="caption">
Illustration of the effects of the experimental design on the counts of Species #1
</p>
</div>
<p>The effect of time on this variable is clear. Furthermore, <em>time</em> and <em>treatment</em> are also interacting as shown by the strong effect of treatment C at t4</p>
</div>
</div>
<div id="performing-the-decomposition" class="section level2">
<h2 class="hasAnchor">
<a href="#performing-the-decomposition" class="anchor"></a>Performing the decomposition</h2>
<p>The function which performs the ASCA decomposition is <code>ASCA_decompose</code> and its results are organized in a list. To run the function it is necessary to provide:</p>
<ul>
<li>a <code>matrix</code> or a <code>data.frame</code> with the counts;</li>
<li>a <code>data.frame</code> with the association between the samples and the design. Beware that numeric columns will results in a decomposition error!</li>
<li>a formula (actually a character vector) which specify the form of the decomposition;</li>
<li>a <code>list</code> with the parameters which will be passed to the <code>glm</code> call;</li>
<li>a character vector which specifies the type of errors which will be returned by <code>glm</code>;</li>
</ul>
<p>The synthetic data we are dealing with are counts so the natural choice is to run a Poisson glm. The formula specifies that we are looking for a 3 term decomposition accounting for the effects of <code>time</code>, <code>treatment</code> and their interaction. Within <code>ASCA-decompose</code> the formula have to be specified following the standard R syntax.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## perform the decomposition</span>
<span class="va">asca0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_decompose.html">ASCA_decompose</a></span><span class="op">(</span>
  d <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>,
  x <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span>, 
  f <span class="op">=</span> <span class="st">"time + treatment + time:treatment"</span>,
  glm_par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s give a look to the structure of the <code>asca0</code> object</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">)</span>
<span class="co">#&gt; List of 14</span>
<span class="co">#&gt;  $ decomposition:List of 3</span>
<span class="co">#&gt;   ..$ time          : num [1:150, 1:10] -6.95 -6.95 -6.95 -6.95 -6.95 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:150] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;   ..$ treatment     : num [1:150, 1:10] 1.05 1.05 1.05 1.05 1.05 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:150] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;   ..$ time:treatment: num [1:150, 1:10] 4.45 4.45 4.45 4.45 4.45 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:150] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ mu           : Named num [1:10] 0.936 2.957 4.007 5.002 5.996 ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ residuals    : num [1:150, 1:10] -0.6 -0.6 -0.6 0.4 -0.6 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:150] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ prediction   : num [1:150, 1:10] -0.511 -0.511 -0.511 -0.511 -0.511 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:150] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ pseudoR2     : Named num [1:10] 0.987 0.995 0.986 0.996 0.997 ...</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;  $ glm_par      :List of 1</span>
<span class="co">#&gt;   ..$ family:List of 12</span>
<span class="co">#&gt;   .. ..$ family    : chr "poisson"</span>
<span class="co">#&gt;   .. ..$ link      : chr "log"</span>
<span class="co">#&gt;   .. ..$ linkfun   :function (mu)  </span>
<span class="co">#&gt;   .. ..$ linkinv   :function (eta)  </span>
<span class="co">#&gt;   .. ..$ variance  :function (mu)  </span>
<span class="co">#&gt;   .. ..$ dev.resids:function (y, mu, wt)  </span>
<span class="co">#&gt;   .. ..$ aic       :function (y, n, mu, wt, dev)  </span>
<span class="co">#&gt;   .. ..$ mu.eta    :function (eta)  </span>
<span class="co">#&gt;   .. ..$ initialize:  expression({  if (any(y &lt; 0))  stop("negative values not allowed for the 'Poisson' family")  n &lt;- rep.int(1, nobs| __truncated__</span>
<span class="co">#&gt;   .. ..$ validmu   :function (mu)  </span>
<span class="co">#&gt;   .. ..$ valideta  :function (eta)  </span>
<span class="co">#&gt;   .. ..$ simulate  :function (object, nsim)  </span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "family"</span>
<span class="co">#&gt;  $ res_type     : chr "response"</span>
<span class="co">#&gt;  $ varimp       : num [1:10, 1:3] 46.088 24.899 14.319 14.42 0.154 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr [1:10] "s1" "s2" "s3" "s4" ...</span>
<span class="co">#&gt;   .. ..$ : chr [1:3] "time" "treatment" "time:treatment"</span>
<span class="co">#&gt;  $ terms_L2     : Named num [1:3] 56.2 25.2 41</span>
<span class="co">#&gt;   ..- attr(*, "names")= chr [1:3] "time" "treatment" "time:treatment"</span>
<span class="co">#&gt;  $ d            :'data.frame':   150 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ time     : chr [1:150] "t1" "t1" "t1" "t1" ...</span>
<span class="co">#&gt;   ..$ treatment: chr [1:150] "A" "A" "A" "A" ...</span>
<span class="co">#&gt;  $ x            :'data.frame':   150 obs. of  10 variables:</span>
<span class="co">#&gt;   ..$ s1 : int [1:150] 0 0 0 1 0 2 1 1 1 0 ...</span>
<span class="co">#&gt;   ..$ s2 : int [1:150] 1 1 3 1 4 3 0 2 2 0 ...</span>
<span class="co">#&gt;   ..$ s3 : int [1:150] 13 12 15 16 22 9 16 22 13 13 ...</span>
<span class="co">#&gt;   ..$ s4 : int [1:150] 35 43 44 36 33 35 40 39 39 34 ...</span>
<span class="co">#&gt;   ..$ s5 : int [1:150] 115 108 88 93 85 107 77 104 77 98 ...</span>
<span class="co">#&gt;   ..$ s6 : int [1:150] 88 88 98 95 102 123 94 98 92 99 ...</span>
<span class="co">#&gt;   ..$ s7 : int [1:150] 133 175 151 151 129 155 138 152 155 135 ...</span>
<span class="co">#&gt;   ..$ s8 : int [1:150] 67 52 50 59 61 61 59 52 59 56 ...</span>
<span class="co">#&gt;   ..$ s9 : int [1:150] 14 16 18 21 18 23 23 24 19 12 ...</span>
<span class="co">#&gt;   ..$ s10: int [1:150] 8 3 5 6 5 7 8 8 6 10 ...</span>
<span class="co">#&gt;  $ f            : chr "time + treatment + time:treatment"</span>
<span class="co">#&gt;  $ combined     : NULL</span>
<span class="co">#&gt;  $ linkinv      :function (eta)  </span>
<span class="co">#&gt;  - attr(*, "class")= chr "ASCA_decomposition"</span></code></pre></div>
<p>For a detailed description of the elements of the list the reader could refer to the documentation. The main output of the function is a list which holds the result of the decomposition (<code>asca0$decomposition</code>). Each matrix matrix contains the expected values estimated by the glm model of the individual variables. Printing the names helps understanding the structure of the array</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## matrix associated to the "time" factor</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
<span class="co">#&gt;   [1] "1"   "2"   "3"   "4"   "5"   "6"   "7"   "8"   "9"   "10"  "11"  "12" </span>
<span class="co">#&gt;  [13] "13"  "14"  "15"  "16"  "17"  "18"  "19"  "20"  "21"  "22"  "23"  "24" </span>
<span class="co">#&gt;  [25] "25"  "26"  "27"  "28"  "29"  "30"  "31"  "32"  "33"  "34"  "35"  "36" </span>
<span class="co">#&gt;  [37] "37"  "38"  "39"  "40"  "41"  "42"  "43"  "44"  "45"  "46"  "47"  "48" </span>
<span class="co">#&gt;  [49] "49"  "50"  "51"  "52"  "53"  "54"  "55"  "56"  "57"  "58"  "59"  "60" </span>
<span class="co">#&gt;  [61] "61"  "62"  "63"  "64"  "65"  "66"  "67"  "68"  "69"  "70"  "71"  "72" </span>
<span class="co">#&gt;  [73] "73"  "74"  "75"  "76"  "77"  "78"  "79"  "80"  "81"  "82"  "83"  "84" </span>
<span class="co">#&gt;  [85] "85"  "86"  "87"  "88"  "89"  "90"  "91"  "92"  "93"  "94"  "95"  "96" </span>
<span class="co">#&gt;  [97] "97"  "98"  "99"  "100" "101" "102" "103" "104" "105" "106" "107" "108"</span>
<span class="co">#&gt; [109] "109" "110" "111" "112" "113" "114" "115" "116" "117" "118" "119" "120"</span>
<span class="co">#&gt; [121] "121" "122" "123" "124" "125" "126" "127" "128" "129" "130" "131" "132"</span>
<span class="co">#&gt; [133] "133" "134" "135" "136" "137" "138" "139" "140" "141" "142" "143" "144"</span>
<span class="co">#&gt; [145] "145" "146" "147" "148" "149" "150"</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span><span class="op">$</span><span class="va">time</span><span class="op">)</span>
<span class="co">#&gt;  [1] "s1"  "s2"  "s3"  "s4"  "s5"  "s6"  "s7"  "s8"  "s9"  "s10"</span></code></pre></div>
<p>The 150 samples are organized along the first dimension, while the decomposition terms span the second dimension. The last dimension holds the experimental variables.</p>
</div>
<div id="validation" class="section level2">
<h2 class="hasAnchor">
<a href="#validation" class="anchor"></a>Validation</h2>
<p>A permutation based approach has been proposed as a test of the significance of the ASCA decomposition. The rationale behind the idea is to empirically construct a set of null models by repeatedly (and independently) permuting the design labels. These null models can then be used to construct the empirical distribution (and quantiles) of almost all model outcomes.</p>
<p>In the <code>gASCA</code> package the permutation based approach has been implemented. In particular it can be used to assess the significance of the following quantities</p>
<ul>
<li>the L2 norm of the decomposition terms, which assess the significance of each model</li>
<li>the variable importance</li>
<li>the null distribution of the univariate pseudo-R2, which can be seen as a proxy of the overall model fit for each variable</li>
</ul>
<p>The <code>ASCA_permutation</code> function, requires as input the results of <code>ASCA_decompose</code> the number of independent permutations (500 by default) and the empirical quantile used to judge the significance (0.95 by default).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## perform the permutation based approach</span>
<span class="va">asca0_validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_permutation.html">ASCA_permutation</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">)</span></code></pre></div>
<p>The following plot shows the results of the validation on the L2 norm of the three decomposition terms.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_validation</span><span class="op">$</span><span class="va">L2_qt</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"term"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_column</span><span class="op">(</span>actual <span class="op">=</span> <span class="va">asca0</span><span class="op">$</span><span class="va">terms_L2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">term</span>, levels <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">term</span>, y <span class="op">=</span> <span class="va">actual</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">term</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">term</span>, yend <span class="op">=</span> <span class="va">actual</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">term</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"term-L2"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Term"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>In the previous plot the term L2 norms (blue dots) are compared with their 95th percentile on the 500 permuted dataset (red dots). In all three cases, the observed matrix norm is larger than the one which should be expected by chance and this indicate that the three terms are all significant, as expected for the synthetic dataset.</p>
<p>In therms of variable importance the situation is the following:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0</span><span class="op">$</span><span class="va">varimp</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"var"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">var</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">asca0_validation</span><span class="op">$</span><span class="va">varimp_qt</span> <span class="op">%&gt;%</span> 
              <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"var"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">var</span>, values_to <span class="op">=</span> <span class="st">"value_qt"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">var</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">var</span>, yend <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">value_qt</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, scales <span class="op">=</span> <span class="st">"free"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Vecror Norm"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Variable"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("var", "name")</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>As before, the red dots indicate the empirical quantiles upon permutation of the design. The picture we get with this analysis is in line to the characteristics of the simulated dataset. In particular.</p>
<ul>
<li>As expected the first four variables are responsive to a different extent to the time factor</li>
<li>S5 and s6 are correctly identified as sensitive to treatment. Unexpectedly, however, also s1 turns out to be responsive to treatment, but remember that s1 was affected by the interaction between the two main factors.</li>
<li>As far as the interaction is concerned, only s1 seems to be significantly affected, with s2</li>
</ul>
<div id="univariate-model-fit" class="section level3">
<h3 class="hasAnchor">
<a href="#univariate-model-fit" class="anchor"></a>Univariate model fit</h3>
<p>The last parameter which was included in the validation process is the pseudo-R2 of the set of univariate models. In classical ASCA, the inspection and the eigen decomposition of the residual matrix has proven to be useful and informative in identifying unmodeled patterns in the data. Unfortunately, this step it is not necessarily informative in glm based ASCA, since the matrix of residuals in the response space is not always easy to interpret (e.g the error matrix of a poisson ASCA of a matrix of species counts holds the difference between observed and predicted counts).<br>
Here we propose to use a measure of univariate model fit at least to identify the set of variables which are less responsive to the experimental design. For glms, pseudo-<span class="math inline">\(R^{2}\)</span> is one of the possible measures of fit which is defined comparing the devicence of the fit of the proposed model with the one of a “null” constant model.</p>
<p><span class="math display">\[
R^{2}_{pseudo} = 1 - \frac{deviance_{residuals}}{deviance_{null}}
\]</span></p>
<p>In practical terms, the parameter gets closer to 1 if the deviance of the residuals of the proposed model is smaller than the one of a constant model.</p>
<p>The “significance” of this parameter can also be assessed in the permutation test and the validation is included in the package functionality. In the package, the calculation of the pseudo-<span class="math inline">\(R^{2}\)</span> for the set of the measured variables is part of the output of the <code>ASCA_decompose</code> function. In the case of the synthetic dataset the trend of the pseudo_<span class="math inline">\(R^{2}\)</span> for the the variables and the results of the validation are shown in the following plot:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_validation</span><span class="op">$</span><span class="va">R2_qt</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"var"</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">add_column</span><span class="op">(</span>actual <span class="op">=</span> <span class="va">asca0</span><span class="op">$</span><span class="va">pseudoR2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">var</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">actual</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">var</span>, yend <span class="op">=</span> <span class="va">actual</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkred"</span>, size <span class="op">=</span> <span class="fl">3</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"pseudo-R2"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Variable"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Also here the blue dots represent the univariate model pseudo-<span class="math inline">\(R^{2}\)</span>, while the red dots shows its null 95th percentile. The first 6 variables shows a large and significant pseudo-<span class="math inline">\(R^{2}\)</span> and this is not only indicating that they are significantly responding to the design, but also that the proposed model is capturing a large fraction of the data variability. It is also interesting to observe that, not unexpectedly, the univariate null quantiles are similar for all the 10 variables.</p>
<p>It is important to point out that when dealing with a glm with an identity link function, the overall model fit can still be inspected relying on the matrix of the residuals in the response space. As in classical ASCA, a PCA of this matrix is useful to perform a multivariate investigation of the unmodeled structure of the dataset. Bear in mind that in the case of dataset consisting of reasonably large counts, a gaussian modelling of the log-transformed values could give a good representation of the data structure.</p>
</div>
</div>
<div id="analysis-of-the-decomposition-terms" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-the-decomposition-terms" class="anchor"></a>Analysis of the decomposition terms</h2>
<div id="eigenvectors-and-multivariate-decomposition" class="section level3">
<h3 class="hasAnchor">
<a href="#eigenvectors-and-multivariate-decomposition" class="anchor"></a>Eigenvectors and Multivariate Decomposition</h3>
<p>Let’s now analyse the three decomposition matrices in terms of their multivariate latent factors. Depending on the term these LV can be interpreted as “eigentrends” (for time) or “eigentreatment” (for treatment) and they are actually what we would like to interpret. Remember that the rank of the matrix associated to each factor is determined by the number of levels of each factor because the decomposition matrices are constructed with the model expected values. The number of LVs will be then equal to the number of factors minus one.</p>
<p>As an example, this is the set of predicted values for the time factor of variable s1</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span><span class="op">$</span><span class="va">time</span><span class="op">[</span>,<span class="st">"s1"</span><span class="op">]</span>, ylab <span class="op">=</span> <span class="st">"I"</span>, xlab <span class="op">=</span> <span class="st">"Sample Index"</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>The presence of a limited number of constant values is coherent with the levels of the time factor, while the scale on the y axis shows that predictions are performed in the linear predictor space. Since the <em>time</em> factor has 5 levels the rank of the matrix will be four. We then expect four eigentrends. Their relative importance is proportional to the individual eigenvalues.</p>
<p>The SVD decomposition of the ASCA array is performed by the <code>ASCA_svd</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_svd.html">ASCA_svd</a></span><span class="op">(</span><span class="va">asca0</span><span class="op">$</span><span class="va">decomposition</span><span class="op">)</span></code></pre></div>
<p>Also here the result is a list with each element holding the results of the svd of the single decomposition terms which have been performed by using the <code>prcomp</code> function of base R. As in a usual PCA analysis the amount of explained variability (square of the standard deviation) can be used to identify how many eigentrends it would be necessary to consider to present an informative representation of the overall matrix. This type of representation is known as <em>scree plot</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## here we make a scree plot of the three decomposition terms</span>
<span class="fu">map</span><span class="op">(</span><span class="va">asca0_svd</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="va">sdev</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">.</span>, rownames <span class="op">=</span> <span class="st">"PC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">enframe</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"term"</span>, value <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># mutate(data = map(data,~ .x %&gt;% mutate(value = (value/sum(value))*100))) %&gt;% </span>
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>PC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">PC</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">PC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Variances"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>The previous plot suggests that two LVs represent good aproximation for all the three factors (actually for treatment 2 LVs are not an approximation)</p>
<p>Let’s start with the <code>time</code> term. Its latent variables can be interpreted as latent “eigentrend” which highlights underlying general patterns shared by group of variables. The best way to highlight that is to plot the separate scores for the first two LVs as a function of the <em>time</em> design factor</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span><span class="op">$</span><span class="va">time</span><span class="op">$</span><span class="va">x</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.x</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>      <span class="co">## this is needed to compensate for computational inaccuracies</span>
  <span class="fu">add_column</span><span class="op">(</span>time <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>, <span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Scores"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The first eigentrend is characterized by a steadily increasing tendency which contrasts with the evolution of the second “U” shaped profile. As in standard pca, their loadings will tell which measured variables are mainly associated to them</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_svd</span><span class="op">$</span><span class="va">time</span><span class="op">$</span><span class="va">rotation</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">species</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">species</span>,<span class="va">PC1</span>,<span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">species</span>, yend <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span> <span class="op">(</span><span class="st">"Loadings"</span><span class="op">)</span><span class="op">+</span>
   <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The loadings plot indicates that s1 and s1 are highly contributing to the increasing eigentrend, while s3 and s4 mainly characterize the second LV. This is in keeping with the expected characteristics of the synthetic dataset. The real time trends of the measured values for s1 amd s3 are indeed the following.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>, <span class="va">treatment</span>, <span class="va">s1</span>,<span class="va">s3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,
             position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span><span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span>, 
        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>In the case of the <code>treatment</code>, we are dealing with only two eigenvectors since the number of levels of this factor is three.</p>
<p>Due to the limited number of levels the plots of the individual eigen-treatments highligths a differantiation between the three levels along PC1, and a separation between A/C and B along PC2.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">asca0_svd</span><span class="op">$</span><span class="va">treatment</span><span class="op">$</span><span class="va">x</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.x</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>      <span class="co">## this is needed to compensate for computational differences across the glm estimations</span>
  <span class="fu">add_column</span><span class="op">(</span>treatment <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">treatment</span>, <span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"steelblue"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Scores in response space"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>The same line of reasoning can be applied also to the interpretation of the LVs of the <code>time:treatment</code> factors, but the interpretation of the LV associated to the interaction terms is not straightforward. Combining two or more decomposition terms prior to SVD could be an informative workaround to the problem. In particular, combining the <code>time</code> and <code>time:treatment</code> could highlight the role of the treatment in shaping the time trends.</p>
</div>
<div id="combining-terms" class="section level3">
<h3 class="hasAnchor">
<a href="#combining-terms" class="anchor"></a>Combining terms</h3>
<p>The function <code>ASCA_combine_terms</code> allows the combination of different factor matrices. The function accepts as input the output of an <code>ASCA_decomposition</code> and a character vector specifying which terms should be combined.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## combine two terms</span>
<span class="va">asca0_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_combine_terms.html">ASCA_combine_terms</a></span><span class="op">(</span><span class="va">asca0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>,<span class="st">"time:treatment"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## perform the svd of the combined decomposition </span>
<span class="va">asca0_comb_svd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ASCA_svd.html">ASCA_svd</a></span><span class="op">(</span><span class="va">asca0_comb</span><span class="op">$</span><span class="va">decomposition</span><span class="op">)</span></code></pre></div>
<p>In terms of the eigenvalues of the LVs:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## here we use the base pscree plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">asca0_comb_svd</span><span class="op">$</span><span class="va">`time+time:treatment`</span>, main <span class="op">=</span> <span class="st">"time + time:treatment"</span>, col <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>The rank of the matrix here is larger (10), but the major trends are still captured by the first two components. Their eigentrends are plot in the following figure:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_comb_svd</span><span class="op">$</span><span class="va">`time+time:treatment`</span><span class="op">$</span><span class="va">x</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.x</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>      <span class="co">## this is needed to compensate for computational inaccuracies</span>
  <span class="fu">add_column</span><span class="op">(</span>time <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">time</span>,
             treatment <span class="op">=</span> <span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>,<span class="va">treatment</span>, <span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">treatment</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">name</span>,<span class="va">treatment</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Here the time dependent interplay between time and treatment along the first component is clear. Treatment “C” is responsible of a modification in the time profile of the first eigentrend. In terms of loadings, the picture is similar to the previous one (the flip in the sign of the loadings of eig2 is the result of the sign indetermination for svd). If one focusses on eig1 (which accounts for almost the 90% of the matrix variance), s1 and s2 are almost the only contributors and this highlights the influence of <code>time</code> and <code>time:treatment</code> on the measured intensities of these two variables.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">asca0_comb_svd</span><span class="op">$</span><span class="va">`time+time:treatment`</span><span class="op">$</span><span class="va">rotation</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_tibble</span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">species</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">species</span>,<span class="va">PC1</span>,<span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"PC"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span>, y <span class="op">=</span> <span class="fl">0</span>, xend <span class="op">=</span> <span class="va">species</span>, yend <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"steelblue"</span>, lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span> <span class="op">(</span><span class="st">"Loadings"</span><span class="op">)</span><span class="op">+</span>
   <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>The role of S1 in determining eig1 can be seen in the original data after log transformation.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tibble</span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">design</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">synth_count_data</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"s"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>,<span class="va">treatment</span>,<span class="va">s1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">s1</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>,
             position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span><span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Variable S1"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme</span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">0.5</span>, 
        legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="Asca_dec_count_data_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Here the green dots of treatment C are absent in t1 (so C is “negatively” contributing at t1), while they get larger than their blue and red counterparts in t3, t4 and - marginally- t5. Treatment C has then a steeper increasing trend, as highlighted by the first eigen-trend of the combined ASCA.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Pietro Franceschi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
